# Socket.IO å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨å¿«é€Ÿå¯åŠ¨åŸºäº Socket.IO çš„æœºå™¨äººæ§åˆ¶ç³»ç»Ÿã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

- Python 3.8+
- Node.js 16+
- npm æˆ– yarn

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å®‰è£… Python ä¾èµ–

```bash
cd robot-control-system
pip install -r requirements.txt
```

è¿™å°†å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š
- fastapi
- uvicorn
- pyzmq
- pyyaml
- **python-socketio** â­

### 2ï¸âƒ£ å®‰è£…å‰ç«¯ä¾èµ–

```bash
cd robot-control-web
npm install
```

è¿™å°†å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š
- react
- react-dom
- **socket.io-client** â­
- vite

### 3ï¸âƒ£ å¯åŠ¨åç«¯æœåŠ¡

```bash
cd ..
python main.py
```

æ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
============================================================
æœºå™¨äººè¿œç¨‹æ§åˆ¶ç³»ç»Ÿ
Robot Control System
============================================================
Starting Worker process...
Starting WebSocket Server process...
All processes started successfully

============================================================
âœ“ WebSocket Server: ws://0.0.0.0:8000/ws
âœ“ Worker Process: Running
============================================================
```

**æ³¨æ„**ï¼šè™½ç„¶æ˜¾ç¤º `ws://`ï¼Œä½†å®é™…ä¸Šæ˜¯ Socket.IO æœåŠ¡ï¼Œä½¿ç”¨ `http://` è¿æ¥ã€‚

### 4ï¸âƒ£ å¯åŠ¨å‰ç«¯å®¢æˆ·ç«¯

æ‰“å¼€æ–°ç»ˆç«¯ï¼š

```bash
cd robot-control-web
npm run dev
```

æ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
VITE v5.0.8  ready in 123 ms

âœ  Local:   http://localhost:3000/
âœ  Network: http://192.168.1.100:3000/
```

### 5ï¸âƒ£ è®¿é—® Web å®¢æˆ·ç«¯

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**http://localhost:3000**

## ğŸ¯ ä½¿ç”¨æµç¨‹

### æ­¥éª¤ 1ï¼šè¿æ¥æœåŠ¡å™¨

1. åœ¨"Socket.IO è¿æ¥"é¢æ¿ä¸­
2. ç¡®è®¤åœ°å€ä¸º `http://localhost:8000`
3. ç‚¹å‡»"è¿æ¥"æŒ‰é’®
4. ç­‰å¾…æç¤º"âœ“ Socket.IO è¿æ¥æˆåŠŸ"

### æ­¥éª¤ 2ï¼šä¸Šä¼ é¡¹ç›®

1. å‡†å¤‡ä¸€ä¸ªåŒ…å«æœºå™¨äººä»£ç çš„ ZIP æ–‡ä»¶
2. åœ¨"é¡¹ç›®ä¸Šä¼ "é¢æ¿ä¸­ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"
3. é€‰æ‹© ZIP æ–‡ä»¶
4. ç‚¹å‡»"ä¸Šä¼ é¡¹ç›®"
5. ç­‰å¾…æç¤º"âœ“ é¡¹ç›®ä¸Šä¼ æˆåŠŸ"

**æµ‹è¯•æ–‡ä»¶**ï¼šå¯ä»¥ä½¿ç”¨é¡¹ç›®ä¸­çš„ `test_python_project.zip`

### æ­¥éª¤ 3ï¼šå¯åŠ¨é¡¹ç›®

1. åœ¨"é¡¹ç›®æ§åˆ¶"é¢æ¿ä¸­
2. ç‚¹å‡»"å¯åŠ¨é¡¹ç›®"æŒ‰é’®
3. ç­‰å¾…æç¤º"âœ“ é¡¹ç›®å¯åŠ¨æˆåŠŸ"

### æ­¥éª¤ 4ï¼šæ‰§è¡ŒæŒ‡ä»¤

**æ–¹å¼ 1ï¼šæ‰‹åŠ¨è¾“å…¥**

1. åœ¨"å‡½æ•°è°ƒç”¨"é¢æ¿ä¸­
2. è¾“å…¥å¯¹è±¡åç§°ï¼ˆå¦‚ `robot_controller`ï¼‰
3. è¾“å…¥æ–¹æ³•åç§°ï¼ˆå¦‚ `stand_up`ï¼‰
4. ç‚¹å‡»"æ‰§è¡ŒæŒ‡ä»¤"

**æ–¹å¼ 2ï¼šå¿«æ·å‘½ä»¤**

1. åœ¨"å¿«æ·å‘½ä»¤"é¢æ¿ä¸­
2. ç‚¹å‡»é¢„è®¾çš„å‘½ä»¤æŒ‰é’®
3. ä¾‹å¦‚ï¼š"ç«™ç«‹"ã€"è¶´ä¸‹"ç­‰

### æ­¥éª¤ 5ï¼šæŸ¥çœ‹æ—¥å¿—

æ‰€æœ‰æ“ä½œå’Œå“åº”éƒ½ä¼šæ˜¾ç¤ºåœ¨"æ—¥å¿—"é¢æ¿ä¸­ï¼ŒåŒ…æ‹¬ï¼š
- è¿æ¥çŠ¶æ€
- æŒ‡ä»¤å‘é€
- æœåŠ¡å™¨å“åº”
- å›è°ƒæ¶ˆæ¯

## ğŸ”Œ Socket.IO ç‰¹æ€§æ¼”ç¤º

### è‡ªåŠ¨é‡è¿

1. å…³é—­åç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰
2. è§‚å¯Ÿæ—¥å¿—æ˜¾ç¤º"è¿æ¥å·²æ–­å¼€"
3. é‡æ–°å¯åŠ¨åç«¯æœåŠ¡
4. è§‚å¯Ÿæ—¥å¿—æ˜¾ç¤º"âœ“ é‡æ–°è¿æ¥æˆåŠŸ"

### å¿ƒè·³æ£€æµ‹

Socket.IO ä¼šè‡ªåŠ¨å‘é€å¿ƒè·³åŒ…ä¿æŒè¿æ¥æ´»è·ƒï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ã€‚

### äº‹ä»¶é©±åŠ¨

æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºäº‹ä»¶ï¼š
- `connect` - è¿æ¥æˆåŠŸ
- `update` - ä¸Šä¼ é¡¹ç›®
- `start` - å¯åŠ¨é¡¹ç›®
- `process` - æ‰§è¡ŒæŒ‡ä»¤
- `callback` - æ¥æ”¶å›è°ƒ
- `disconnect` - æ–­å¼€è¿æ¥

## ğŸ“ ç¤ºä¾‹ä»£ç 

### Python é¡¹ç›®ç»“æ„ï¼ˆtest_python_projectï¼‰

```python
# main.py
class RobotController:
    def __init__(self):
        print("Robot initialized")
    
    def stand_up(self):
        print("Standing up...")
        return {"status": "success", "action": "stand_up"}
    
    def sit_down(self):
        print("Sitting down...")
        return {"status": "success", "action": "sit_down"}

# åˆ›å»ºå…¨å±€å®ä¾‹
robot_controller = RobotController()
```

### è°ƒç”¨ç¤ºä¾‹

**å‰ç«¯å‘é€**ï¼š
```javascript
socket.emit('process', {
  params: {
    object: 'robot_controller',
    method: 'stand_up',
    args: {}
  }
}, (response) => {
  console.log(response)
  // {status: 'success', message: '...', data: {...}}
})
```

**åç«¯å¤„ç†**ï¼š
```python
# è§£æå‚æ•°
obj_name = params['object']  # 'robot_controller'
method_name = params['method']  # 'stand_up'

# åŠ¨æ€è°ƒç”¨
obj = getattr(module, obj_name)  # è·å–å¯¹è±¡
method = getattr(obj, method_name)  # è·å–æ–¹æ³•
result = method(**params.get('args', {}))  # è°ƒç”¨
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: è¿æ¥å¤±è´¥ï¼Ÿ

**æ£€æŸ¥**ï¼š
1. åç«¯æ˜¯å¦å¯åŠ¨ï¼ˆ`python main.py`ï¼‰
2. åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆ`http://localhost:8000`ï¼Œä¸æ˜¯ `ws://`ï¼‰
3. ç«¯å£ 8000 æ˜¯å¦è¢«å ç”¨

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8000

# å¦‚æœæœ‰è¿›ç¨‹å ç”¨ï¼Œç»ˆæ­¢å®ƒ
kill -9 <PID>
```

### Q: æ— æ³•ä¸Šä¼ æ–‡ä»¶ï¼Ÿ

**æ£€æŸ¥**ï¼š
1. æ–‡ä»¶æ˜¯å¦ä¸º ZIP æ ¼å¼
2. æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 100MB
3. Socket.IO æ˜¯å¦å·²è¿æ¥

### Q: æŒ‡ä»¤æ‰§è¡Œå¤±è´¥ï¼Ÿ

**æ£€æŸ¥**ï¼š
1. é¡¹ç›®æ˜¯å¦å·²ä¸Šä¼ 
2. é¡¹ç›®æ˜¯å¦å·²å¯åŠ¨
3. å¯¹è±¡å’Œæ–¹æ³•åç§°æ˜¯å¦æ­£ç¡®
4. Python é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨è¯¥å¯¹è±¡/æ–¹æ³•

### Q: æ—¥å¿—ä¸­æ–‡ä¹±ç ï¼Ÿ

**è§£å†³**ï¼šç¡®ä¿ç»ˆç«¯ä½¿ç”¨ UTF-8 ç¼–ç ã€‚

## ğŸ“Š æ€§èƒ½æç¤º

### åç«¯

- ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒé¿å…ä¾èµ–å†²çª
- å®šæœŸæ¸…ç† `storage/projects/` ç›®å½•
- ç›‘æ§è¿›ç¨‹å†…å­˜å ç”¨

### å‰ç«¯

- ä½¿ç”¨ç”Ÿäº§æ„å»ºéƒ¨ç½²ï¼ˆ`npm run build`ï¼‰
- é¿å…ä¸Šä¼ è¿‡å¤§çš„æ–‡ä»¶
- åŠæ—¶æ¸…ç†æ—¥å¿—ï¼ˆ"æ¸…ç©ºæ—¥å¿—"æŒ‰é’®ï¼‰

## ğŸ“ ä¸‹ä¸€æ­¥

1. ğŸ“– é˜…è¯» [æ¶æ„è®¾è®¡æ–‡æ¡£](ARCHITECTURE.md) äº†è§£ç³»ç»Ÿè®¾è®¡
2. ğŸ”Œ æŸ¥çœ‹ [Socket.IO è¿ç§»æŒ‡å—](SOCKETIO_MIGRATION.md) äº†è§£æŠ€æœ¯ç»†èŠ‚
3. âš›ï¸ é˜…è¯» [React å®¢æˆ·ç«¯æ–‡æ¡£](../robot-control-web/README.md) å­¦ä¹ å‰ç«¯å¼€å‘
4. âœ… æŸ¥çœ‹ [æµ‹è¯•æŠ¥å‘Š](TEST_REPORT.md) äº†è§£ç³»ç»Ÿæµ‹è¯•

## ğŸ’¡ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰è¿æ¥å‚æ•°

ä¿®æ”¹ `robot-control-web/src/hooks/useSocketIO.js`ï¼š

```javascript
const socket = io(url, {
  transports: ['websocket', 'polling'],
  reconnection: true,
  reconnectionDelay: 1000,      // é‡è¿å»¶è¿Ÿï¼ˆmsï¼‰
  reconnectionAttempts: 5,      // æœ€å¤§é‡è¿æ¬¡æ•°
  timeout: 20000                // è¿æ¥è¶…æ—¶ï¼ˆmsï¼‰
})
```

### è‡ªå®šä¹‰å›è°ƒå¤„ç†

åœ¨ `useSocketIO.js` ä¸­æ·»åŠ æ›´å¤šäº‹ä»¶ç›‘å¬ï¼š

```javascript
socket.on('custom_event', (data) => {
  addLog(`è‡ªå®šä¹‰äº‹ä»¶: ${JSON.stringify(data)}`, 'info')
})
```

### éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

1. **åç«¯**ï¼š
   ```bash
   # ä½¿ç”¨ gunicorn + uvicorn worker
   pip install gunicorn
   gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app
   ```

2. **å‰ç«¯**ï¼š
   ```bash
   npm run build
   # å°† dist/ ç›®å½•éƒ¨ç½²åˆ° Nginx/Apache
   ```

## ğŸ‰ æˆåŠŸï¼

æ‚¨å·²æˆåŠŸå¯åŠ¨åŸºäº Socket.IO çš„æœºå™¨äººæ§åˆ¶ç³»ç»Ÿï¼

**äº«å—æ›´å¯é çš„å®æ—¶é€šä¿¡ä½“éªŒ**ï¼š
- âœ… è‡ªåŠ¨é‡è¿
- âœ… å¿ƒè·³æ£€æµ‹
- âœ… äº‹ä»¶é©±åŠ¨
- âœ… ç”Ÿäº§å°±ç»ª

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…å…¶ä»–æ–‡æ¡£æˆ–æäº¤ Issueã€‚

